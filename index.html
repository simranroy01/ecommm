<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookstore Admin Page</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <h2>Bookstore Admin Page</h2>

    <div class="container">
        <!-- Add Product Form -->
        <div class="form-container">
            <h3>Add a New Product</h3>
            <form id="productForm">
                <div class="form-group">
                    <label for="productCode">Product Code</label>
                    <input type="text" id="productCode" placeholder="Enter Product Code" required>
                </div>
                <div class="form-group">
                    <label for="price">Price</label>
                    <input type="number" id="price" placeholder="Enter Product Price" required>
                </div>
                <button type="button" onclick="addProduct()">Add Product</button>
            </form>
        </div>

        <!-- Product Display Grid -->
        <div class="product-grid" id="productGrid">
            <!-- Product cards will be injected here dynamically -->
        </div>
    </div>

    <script src="config.js"></script>
    <script src="cognito.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetchProducts();
            checkUserLoggedIn(); // Check if user is logged in
        });

        function checkUserLoggedIn() {
            const currentUser = getCurrentUser(); // Function from cognito.js to get the current user
            if (!currentUser) {
                alert('You need to be logged in to access this page.');
                window.location.href = 'login.html'; // Redirect to login page
            }
        }

        function addProduct() {
            const productCode = document.getElementById('productCode').value;
            const price = document.getElementById('price').value;

            const data = {
                operation: 'addProduct',
                productCode: productCode,
                price: price
            };

            fetch('https://9n7xdpv8o4.execute-api.us-east-1.amazonaws.com/dev/getData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(result => {
                alert(JSON.parse(result.body));
                document.getElementById('productCode').value = '';
                document.getElementById('price').value = '';
                fetchProducts(); // Refresh product list after adding
            })
            .catch(error => {
                console.error('Error adding product:', error);
            });
        }

        function fetchProducts() {
            const requestData = { operation: 'listProduct' };

            fetch('https://9n7xdpv8o4.execute-api.us-east-1.amazonaws.com/dev/getData', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestData),
            })
            .then(response => response.json())
            .then(responseData => {
                const products = JSON.parse(responseData.body);
                const productGrid = document.getElementById('productGrid');
                productGrid.innerHTML = ''; // Clear existing products

                products.forEach(product => {
                    createProductCard(product);
                });
            })
            .catch(error => {
                console.error('Error fetching products:', error);
            });
        }

        function createProductCard(product) {
            const productGrid = document.getElementById('productGrid');
            const card = document.createElement('div');
            card.className = 'product-card';

            const productCode = document.createElement('h4');
            productCode.textContent = `Code: ${product.productCode}`;
            card.appendChild(productCode);

            const price = document.createElement('p');
            price.textContent = `Price: $${product.price}`;
            card.appendChild(price);

            const createdAt = document.createElement('p');
            createdAt.textContent = `Added on: ${product.createdAt}`;
            card.appendChild(createdAt);

            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.onclick = function() {
                deleteProduct(product.productCode);
            };
            card.appendChild(deleteButton);

            productGrid.appendChild(card);
        }

        function deleteProduct(productCode) {
            const data = { operation: 'deleteProduct', productCode: productCode };

            fetch('https://9n7xdpv8o4.execute-api.us-east-1.amazonaws.com/dev/getData', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(result => {
                alert(JSON.parse(result.body));
                fetchProducts(); // Refresh product list after deletion
            })
            .catch(error => {
                console.error('Error deleting product:', error);
            });
        }
    </script>

</body>
</html>
